:figure-caption!:
:tocs!:

## 2.10.2018 🚀

* Zaczynamy od przeczytania/przejrzenia
  https://github.com/uohzxela/clean-code-ruby[🛁 Clean Code concepts adapted for Ruby]. +
  Na wykładzie wyjaśnimy dokładniej niektóre opisanych tam
  **zaawansowanych** rzeczy, na przykład co oznacza skrótowiec SOLID,
  co rozumiemy przez refaktoryzację kodu oraz
  czy kod który _smells_ to przeciwieństwo kodu który jest _clean_.

* https://www.sandimetz.com/products[Literatura] – na początek wystarczą nam
  dwie książki Sandi Metz i jej prezentacja z YouTube:
** https://www.youtube.com/watch?v=mpA2F1In41w[Go Ahead, Make a Mess]

.Source https://r-stylelab.com/company/blog/web-development/from-tdd-to-bdd-when-to-switch-and-how-to-apply[From TDD to BDD: When to Switch and How to Apply]
image::images/tdd-cycle.png[TDD Cycle, 575, 386]


## Laboratoria

### 2. Znajdujemy _usterki_ w kodzie

Metrics, Duplication, Style.

. https://github.com/AlDanial/cloc[Cloc] (counts)
. http://ruby.sadi.st/Flog.html[Flog] (ABC complexity).
. http://ruby.sadi.st/Flay.html[Flay] (structural similarities).
. https://docs.rubocop.org/en/latest/[RuboCop] – static code analyzer (a.k.a. linter) and code formatter (style).

#### ABC – discovering pain code

Do wyszukiwania _pain in Ruby code_ użyjemy narzędzia 
https://github.com/seattlerb/flog[Flog] – the higher the
score, the more pain the code is in. 

.verse.rb
```ruby
def verse(n)
  "#{n == 0 ? 'No more' : n} bottle#{'s' if n != 1}" +
  " of beer on the wall, " +
  "#{n == 0 ? 'no more' : n} bottle#{'s' if n != 1} of beer.\n" +
  "#{n > 0  ? "Take #{n > 1 ? 'one' : 'it'} down and pass it around"
            : "Go to the store and buy some more"}, " +
  "#{n-1 < 0 ? 99 : n-1 == 0 ? 'no more' : n-1} bottle#{'s' if n-1 != 1}"+
  " of beer on the wall.\n"
end
```

```sh
flog -ad verse.rb # --all --details
    36.2: flog total
    36.2: flog/method average

    36.2: main#verse                       verse.rb:1-8
    15.2:   branch
     7.0:   +
     6.5:   -
     5.3:   ==
     5.2:   !=
     4.1:   lit_fixnum
     3.3:   >
     1.4:   <
```

### 3. Znajdujemy _problemy w kodzie_ – code smels, churn

. https://github.com/whitesmith/rubycritic[RubyCritics] – a Ruby code quality reporter.
.. https://www.sandimetz.com/blog/2017/9/13/breaking-up-the-behemoth[Breaking Up the Behemoth] –
  zob. _#3: Churn and Complexity_.

#### The smell of the week

Programu **reek** można użyć do wypisania „zapachów” w projekcie napisanym w języku Ruby:

```sh
reek -f json KATALOG | jq .[].documentation_link -r  | sort | uniq -c | sort -n
```
Przykład:
```sh
reek -f json lib | jq .[].documentation_link -r  | sort | uniq -c | sort -n
```

Tutaj jest **link:refactorings.adoc[oficjalna lista code smells i refaktoryzacji]**
dla języka Ruby i Java.
Znaleźć trzy najczęściej występujące zapachy w jakimś większym projekcie Ruby.


### 10. Piszemy kod do gotowych testów

Zakładamy konto na portalu https://exercism.io[Exercism].
Następnie wybieramy **tracks** z językiem obiektowym i przerabiamy
ćwiczenia (10+).


### 4. Refactoryzacje

